// bella-scheduler@1.2.0, by @ndaidong - built on Sun, 04 Jun 2017 07:54:33 GMT - published under MIT license
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){"use strict";var e,t=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),r=Number.MAX_SAFE_INTEGER,a=function(e){return{}.toString.call(e)},i=function(e){return"[object Undefined]"===a(e)},u=function(e,t){return!(!e||!t)&&Object.prototype.hasOwnProperty.call(e,t)},o=function(e,t){if((!e||e<0)&&(e=0),t||(t=r),e===t)return t;e>t&&(e=Math.min(e,t),t=Math.max(e,t));var n=e,a=t-e+1;return Math.floor(Math.random()*a)+n},s=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n="abcdefghijklmnopqrstuvwxyz",r=[n,n.toUpperCase(),"0123456789"].join("").split("").sort(function(){return Math.random()>.5}).join(""),a=r.length,i=Math.max(e||32,t.length),u=t;u.length<i;){var s=o(0,a);u+=r.charAt(s)||""}return u},f=function(){return Date.now()},c=new(function(){function e(){t(this,e),this.size=0,this.data={}}return n(e,[{key:"set",value:function(e,t){var n=this.data;return u(n,e)||this.size++,n[e]=t,this}},{key:"get",value:function(e){return this.data[e]||null}},{key:"all",value:function(){var e=this.data,t=[];for(var n in e)i(e[n])||t.push(e[n]);return t}},{key:"remove",value:function(e){var t=this.data;return!!u(t,e)&&(t[e]=null,delete t[e],this.size--,!0)}}]),e}()),l=function(e,t){for(var n=-1,r=0;r<e.length;r++)if(e[r]===t){n=r;break}return n},d=function(e,t){var n=new Date(e);return n.setDate(n.getDate()+t+7-n.getDay()%7),n},v=function(e,t){var n=0,r=f()-t;if(!e)return-1;var a=parseInt(e[1],10),i=e[2];return"s"===i?n=1e3:"m"===i?n=6e4:"h"===i?n=36e5:"d"===i&&(n=864e5),(n*=a)-r},h=function(e){var t="sun|mon|tue|wed|thu|fri|sat".split("|"),n=new Date,r=t[n.getDay()],a=l(r,t),i=e[1].toLowerCase(),u=l(i,t),o=0,s=0,c=0;e[2]&&(o=parseInt(e[2],10)),e[3]&&(s=parseInt(e[3].replace(/\D/gi,""),10)),e[4]&&(c=parseInt(e[4].replace(/\D/gi,""),10)),n.setHours(o),n.setMinutes(s),n.setSeconds(c);var v=n.getTime(),h=f(),m=n;return(u<a||h>v)&&(m=d(n,a)),m.setHours(o),m.setMinutes(s),m.setSeconds(c),m.getTime()-h},m=function(e){var t="*"===e[1]?"*":parseInt(e[1],10),n="*"===e[2]?"*":parseInt(e[2],10),r="*"===e[3]?"*":parseInt(e[3],10),a="*"===e[4]?"*":parseInt(e[4],10),i="*"===e[5]?"*":parseInt(e[5],10),u="*"===e[6]?"*":parseInt(e[6],10),o=new Date,s=o.getFullYear();if("*"!==t&&t<s)return-1;var c=t,l=n,d=r,v=a,h=i,m=u;"*"===t&&(c=s);var p=o.getMonth()+1;"*"===n&&(l=p);var g=o.getDate();"*"===r&&(d=g);var y=o.getHours();"*"===a&&(v=y);var T=o.getMinutes();"*"===i&&(h=T);var w=new Date(c,l-1,d,v,h,m),D=w.getTime(),M=f(),b=D-M;return b<0&&"*"===i&&(w.setMinutes(h+1),b=(D=w.getTime())-M),b<0&&"*"===a&&(w.setHours(v+1),b=(D=w.getTime())-M),b<0&&"*"===r&&(w.setDate(d+1),b=(D=w.getTime())-M),b<0&&"*"===n&&(w.setMonth(l),b=(D=w.getTime())-M),b<0&&"*"===t&&(w.setFullYear(c+1),b=(D=w.getTime())-M),b},p=function(e,t){var n=/^(\d+)\s?(d|h|m|s)+$/i,r=/^(sun|mon|tue|wed|thu|fri|sat)+\w*\s+(\d+)(:\d+)?(:\d+)?$/i,a=/^(\*|\d+)\s+(\*|\d+)\s+(\*|\d+)\s+(\*|\d+)\s+(\*|\d+)\s+(\d+)$/i,i=e.match(n);return i?v(i,t):(i=e.match(r))?h(i):(i=e.match(a),i?m(i):-1)},g=function(e){e.fn();var t=e.id;if(!e.repeat)return c.remove(t);var n=f();return e.lastTick=n,c.set(t,e),!0},y=function t(){if(e&&clearTimeout(e),c.size>0){var n=2147483647,r=[];c.all().forEach(function(e){var t=e.id,a=p(e.time,e.lastTick);if(a<0)c.remove(t);else if(0===a)e.delay=0,r.push(e);else if(e.delay=a,c.set(t,e),a<=n){n=a;var i=[];i=r.concat(e),r=i.filter(function(e){return e.delay<=n})}}),r.length&&(e=setTimeout(function(){r.map(g),setTimeout(t,1)},n))}},T=function(e,t,n){var r=n?0:1,a=f(),i=s(32),u={id:i,fn:t,time:e,repeat:r,createdAt:a,lastTick:a,delay:0};return c.set(i,u),y(),i},w=function(e){return!!c.remove(e)&&(y(),!0)};module.exports={yearly:function(e,t){return T("* "+e,t)},monthly:function(e,t){return T("* * "+e,t)},daily:function(e,t){return T("* * * "+e,t)},hourly:function(e,t){return T("* * * * "+e,t)},every:function(e,t){return T(e,t)},once:function(e,t){return T(e,t,1)},unregister:w}});